---

---


SET最常用的攻击方法有：用恶意附件对目标进行 E-mail 钓鱼攻击、Java Applet攻击、基于浏览器的漏洞攻击、收集网站认证信息、建立感染的便携媒体、邮件群发等攻击手段。

**环境说明**

* Kali Linux 攻击机
* Win 7 虚拟机靶机
* Windows 10 物理机

**本文目的**

本文将演示如何借助 SET+MSF 渗透工具对局域网内(桥接模式)的 Win 7 虚拟机靶机进行网络钓鱼(欺骗用户的账号密码)、生成木马、获得主机Shell、权限提升、远程桌面监控、账户Hash值获取、日志清除、后门植入、钓鱼邮件等一系列较为完整的渗透测试流程。

## 钓鱼网站

借助 SET 工具构建钓鱼网站，并窃取用户的账号密码。

### 打开set



下面所演示钓鱼网站只适用于不要进行动态验证的网站，例如本人大学所用的教务系统等只需要账户密码的静态验证。

**默认模板**

>   -   1、在使用 SET 前，检查并更新其版本：



>   -   2、在终端输入 setoolkit开始运行 SET：



>   -   3、然后选择第2项——网站攻击模块：
>
>       >   Spear-Phishing Attack Vectors:鱼叉式钓鱼攻击
>       >
>       >   Website Attack Vectors：网站攻击模块
>       >
>       >   Infectious Media Generator：介质感染攻击
>       >
>       >   Create a Payload and Listener：创建攻击载荷和监听
>       >
>       >   Mass Mailer Attack：群发邮件攻击
>       >
>       >   Arduino-Based Attack Vector：基于Arduino攻击
>       >
>       >   Wireless Access Point Attack Vector：无线接入点攻击
>       >
>       >   QRCode Generator Attack Vector：二维码攻击
>       >
>       >   Powershell Attack Vectors：powershell攻击模块
>       >
>       >   Third Party Modules：第三方攻击模块



>   -   4、接着下选择第3项——凭证收集攻击：
>
>   >   Java Applet Attack Method:JAVA Applet攻击方法
>   >
>   >   Metasploit Browser Exploit Method：Metasploit浏览器利用方法
>   >
>   >   Credential Harvester Attack Method：凭证收集器攻击方法
>   >
>   >   Tabnabbing Attack Method：Tabnabbing攻击法
>   >
>   >   Web Jacking Attack Method：WebJacking攻击法
>   >
>   >   Multi-Attack Web Method：多种Web攻击组合法
>   >
>   >   HTA Attack Method：HTA攻击方法



>   -   5、选择第2项——站点克隆：监听设为本机，将学习通登入界面网站网址输入
>
>       >   Web Templates:Web模板
>       >
>       >   Site Cloner：站点克隆
>       >
>       >   Custom Import：模板导入

发现克隆的界面（本机ip在浏览器打开）发现没有输入账号密码界面，说明用了子网站，可以用美团网站测试，发现是成功的

>   -   6、接着需要设置用于钓鱼的IP地址：



(此处默认Kali本机IP;80端口，故需要提前执行命令systemctl stop apache2关闭Apache服务，避免80端口占用，引起冲突)，然后选择钓鱼的网站(下面选择谷歌登录)：

**7、在物理机 Win 11上面访问 Kali 的IP地址：**

即可得到谷歌登录页面，输入账号和密码(登录后会进行跳转到谷歌官网)：

**8、返回Kali：**

可以看到成功收集到刚才输入的账号和密码，攻击成功：

## 站点克隆

除了选择 SET 自带的三个登录站点的模板外，同时SET 也允许攻击者自己选择站点进行克隆，伪造钓鱼网站。

**1、在上面第五步选择第2项——站点克隆：**

**2、将监听的地址设为本机IP**

(直接 Enter 键默认即可)，将克隆的网站地址设置为学习通后台的登录页面，即可成功克隆并进入监听状态：

**3、Win11 物理机访问 Kali 攻击机的 IP 地址**

**4、输入账号和密码， Kali 中可以收集到该信息：**

## 谈二维码

SET 工具包中使用QR Code Attack模块发起二维码攻击，使被欺骗用户扫描你的二维码进入一个伪装钓鱼网站。有人肯定会认为那这个软件没啥用，但是请问正常情况下，给你一个二维码和一个未知网址，你更愿意相信哪一个？答案当然是二维码。

**1、进入社工攻击并选择二维码攻击模块：**

**2、输入要跳转的钓鱼网站的地址：**

**3、使用手机微信扫描出来：**

以上的攻击演示告诉我们几点：

不要轻易打开一个安全性未知的网站链接或者去扫描二维码，并且傻乎乎地输入自己的账号密码等敏感信息，你看到的网站不一定是真的（现实中攻击者会绑定公网IP、公网域名来以假乱真）；

同时请务必留意，不要轻易连接安全性未知的WIFI，因为一旦你进入攻击者设定的WIFI，攻击者完全可以利用局域网内部的DNS欺骗攻击；

关于局域网内如何欺骗网关并进行DNS域名劫持，可参考先前写的另一篇博文：Kali渗透-DNS域名劫持与钓鱼。

## 远控木马

SET 同时集成了木马生成工具，可以生成木马并调用MSF框架对远程主机进行控制。直接使用MSF生成木马并控制主机的可参考之前另一篇博文：渗透测试-Kali入侵Win7主机。

**控制主机**

**1、运行 SET，选择创建攻击载荷和监听器：**

**2、选择攻击模式**

然后设置监听的主机IP(kali攻击机的IP地址)和端口，即可在本地生成木马程序：

**3、将木马程序传给 Win 7 虚拟机**

首先·Kali攻击机开启监听，其次Win 7虚拟机双击运行木马程序：

**4、Kali 攻击机启动MSF框架并获得攻击会话：**

**5、激活会话，获Shell 后操控 Win 7 靶机：**

**6、执行screenshot命令进行屏幕截图：**

**7、执行命令getsystem进行提权攻击，提升至system系统最高权限：**

**8、执行命令hashdump：**

尝试获取系统所有账户的密码的hash值，发现失败。没关系，可以执行Meterpreter 提供的脚本：

**9、补充下Meterpreter 提供的其他攻击脚本：**

执行远程桌面如下：

**10、进一步的攻击：**

还可以执行background将当前会话转移到后台执行，达到后台进程切换的目的。同时可以执行migrate 命令迁移会话进程到指定的进程pid，达到隐藏控制会话的进程，此时原来的进程是看不到的目的(通过ps命令可以看到受害机的哪些进程)。

**日志清除**

**1、先打开 Windows 事件查看器：**

**2、对靶机的日志进行清除：**

在 Meterpreter 执行命令 clearev 命令

**3、重新查看 Win7 的事件查看器：**

系统日志信息已经被清空：但该命令存在的弊端的是，没法指定清除哪一部分的日志，一次性清除容易引起系统管理员的注意。

**创建后门**

当成功获取目标系统的访问权限后，需要寻找方法来恢复与目标主机的连接，而无需再进入目标系统。如果目标用户破坏了该连接，例如重新启动计算机，此时使用后门将允许自动重新与目标系统建立连接。为了后续渗透方便，所以需要创建一个后门，这样即使连接被中断也不会影响工作。

**1、先查看下它的帮助文件：**

**2、执行命令创建一个持久后门：**

输出的信息将显示创建后门的一个过程。Kali 将在目标系统中创建了一个持久脚本(保存在C:\Users\thinkpad\AppData\Local\Temp\naBffRVEO.vbs)并篡改注册表，如下所示：

**3、查看 Win 7 靶机的注册表和系统文件：**

**4、关闭当前攻击会话，重启 Win 7 虚拟机：**

**5、运行 MSF 框架：**

此时在 Kali 虚拟机重新开启一个终端，监听 Win 7 虚拟机是否重启后能自动上线获得攻击会话：

至此，后门植入成功！以后只要Win 7系统开机便会自动运行后门脚本，攻击者可以随时入侵！除非受害主机的管理员发现后删除了注册表相应的键值和系统中植入的后门脚本。此时即使 Win 7 靶机中的远控木马文件 payload.exe 被管理员删除也没关系，下面验证一下。

**6、删除Win 7靶机桌面的木马文件后重启主机：**

**7、Kali 攻击机依然可以控制靶机：**

只不过功能受限，无法提权到最高权限了：

**8、最后：**

将 Win 7靶机上的后门脚本、注册表注册项清除，Kali 攻击机则无法再随意入侵 Win 7 虚拟机靶机了，如下图所示：

以上通过 SET + MSF 渗透工具，演示了如何生成木马、获得主机Shell、主机提权、远程桌面控制、日志清除、后门植入等完整的一次渗透测试攻击。

当攻击者制作了钓鱼网站、木马程序后，便会想法设法将其传给受害者，而常见的传播方式便是钓鱼网站了。安全意识较差的用户在收到钓鱼邮件后点击邮件中的钓鱼链接、下载附件中的木马程序，便可能遭受攻击！

## 工具简介

Swaks 是一款类似于"瑞士军刀"的工具，之所以这么说是因为它在SMTP邮件协议领域有非常非常广泛的应用，同时对于一名信息安全高级工程师来说也是一个不错的利用工具！它通常被用来伪造邮件，进行钓鱼、社工等操作。

**Swaks基本用法：**

**1、swaks --to test@qq.com 测试邮箱的连通性；：**

**2、参数说明：**

--from test@qq.com //发件人邮箱；

--header "Subject:hello" //邮件头信息，subject为邮件标题

--data ./Desktop/email.txt //将正常源邮件的内容保存成TXT文件，再作为正常邮件发送；

**3、Kali 内置了swaks：**

**攻击实例**

**1、在以下网站申请一个临时邮箱用于收件：**

**2、伪造一份来自 360hr 的邮件：**

收件人为clearsky@4533.top，内容为:"Congratulations on your 360 interview. Please click on the link below to enter our employee information page. [https://fishing.com/test.php ;](https://link.zhihu.com/?target=https%3A//fishing.com/test.php)"，如下图所示：

**3、在临时邮箱中收到来自 360hr 的邮件：**

**4、点击查看邮件详情：**

但是，QQ邮箱和网易云邮箱暂不可送达，应该是腾讯、网易设定的安全机制的原因！在此提醒遇到可疑邮件要查看源邮件，判断发信人IP是否为可信任的IP，不然一个贸然的操作有时候将可能导致自己被钓鱼甚至攻击！

废话不多说，给出几条防范社工攻击的建议：

1.当心来路不明的服务供应商等人的电子邮件、即时简讯以及电话。在提供任何个人信息之前验证其可靠性和权威性；

2.永远不要点击来自未知发送者的电子邮件中的嵌入链接，如果有必要就使用搜索引擎寻找目标网站或手动输入网站URL；

3.永远不要在未知发送者的电子邮件中下载附件，如果有必要可以在保护视图中打开附件，这个在许多操作系统中是默认启用的；

4使用强大的防火墙来保护你的电脑空间，及时更新杀毒软件同时提高垃圾邮件过滤器的门槛；

5.下载软件及操作系统补丁，预防零日漏洞，及时跟随软件供应商发布的补丁同时尽可能快地安装补丁版本；

3.关注网站的URL，有时网上的骗子对URL做了细微的改动，将流量诱导进了自己的诈骗网站；

7.不要随意扫描二维码！你所扫描后到的网站可能是一个钓鱼网站；

8.不要轻易连接公告WIFI，进入攻击者设定的局域网环境，你的很多上网隐私将处于裸奔状态，同时容易遭受 ARP欺骗、DNS劫持、网络钓鱼等攻击！

最后，本文仅限于技术讨论与分享，严禁用于非法途径......

今天的内容就分享到这里，总结，我的教学仅供大家学习使用，希望可以对kali linux有一些心得，到这里就结束了。

如果大家对黑客、kali、linux、K8S等小知识感兴趣，点击下方卡片直达~
